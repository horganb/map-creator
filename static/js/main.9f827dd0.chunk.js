(this["webpackJsonpmap-creator"]=this["webpackJsonpmap-creator"]||[]).push([[0],{125:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(10),i=n.n(r),o=(n(91),n(46)),s=n(12),u=n(14),l=n(167),j=n(155),d=n(166),b=n(71),p=n.n(b),f=n(53),O=n.n(f),g=n(170),m=function(e){var t=e.getBoundingClientRect();return{left:t.left+window.scrollX,top:t.top+window.scrollY}},h="https://map-creator-backend.herokuapp.com/",v=document.cookie,x=O.a.parse(v).token;if(!x){x=Object(g.a)();var y=new Date;y.setFullYear(y.getFullYear()+100),document.cookie=O.a.serialize("token",x,{expires:y})}var C=p.a.create({baseURL:h,headers:{Authorization:x}}),w=n(21),k=n(17),P=n(165),E=n(76),D=n.n(E),I=n(158),S=n(168),M=n(163),F=n(172),T=n(164),N=n(171),R=n(159),Y=n(160),H=n(161),z=n(162),U=n(157),X=n(173),L=Object(N.a)("div")({backgroundColor:"white",height:"100%",width:"100%",display:"flex",flexDirection:"column",fontSize:"calc(10px + 2vmin)",color:"gray"}),A=Object(N.a)(j.a)({margin:"1rem"}),B=Object(N.a)(U.a)({padding:"0.25rem 0.5rem"}),$=Object(N.a)(j.a)({padding:"0.5rem 2rem",margin:"0.5rem"}),J=Object(N.a)(L)({alignItems:"center"}),W=Object(N.a)(I.a)({display:"flex",justifyContent:"space-between"}),q=Object(N.a)(S.a)({margin:"0.5rem"}),V=Object(N.a)("input")({display:"none"}),_=Object(N.a)(R.a)({marginRight:"0.5rem"}),G=Object(N.a)(I.a)({backgroundColor:"pink",minHeight:"auto"}),K=Object(N.a)(X.a)({display:"flex",margin:"8px 0",overflow:"auto"}),Q=Object(N.a)(I.a)({justifyContent:"center"}),Z=Object(N.a)(Y.a)({position:"absolute",top:"50%",left:"0.5rem",cursor:"pointer"}),ee=Object(N.a)(H.a)({position:"absolute",top:"50%",right:"0.5rem",cursor:"pointer"}),te=Object(N.a)("div")({flex:"1 1 auto",position:"relative",minHeight:0,width:"calc(100% - 4rem)",alignSelf:"center",display:"flex",alignItems:"center",justifyContent:"center"}),ne=Object(N.a)("div")({flex:"0 0 auto",minHeight:0}),ae=Object(N.a)(z.a)({position:"absolute",cursor:"pointer",transition:"transform 0.2s",WebkitTapHighlightColor:"rgba(255, 255, 255, 0)",padding:"0.5rem"}),ce=Object(N.a)("img")({maxWidth:"100%",maxHeight:"100%"}),re=Object(N.a)(S.a)({width:"100%"}),ie=Object(N.a)(M.a)({transition:"opacity 0.2s"}),oe=Object(N.a)(F.a)({paddingBottom:0,textAlign:"left"}),se=Object(N.a)(T.a)({paddingTop:0,textAlign:"left",overflow:"auto",height:"5rem"}),ue=Object(N.a)("h5")({textTransform:"uppercase",opacity:.5,margin:0,fontSize:"1.4rem"}),le=Object(N.a)("p")({margin:0,fontSize:"1.2rem",fontFamily:"Arial"}),je=n(3),de=function(e){var t=e.pin,n=e.setPin,a=e.onClose,c=e.isEditor,r=t||{},i=r.title,o=r.description,s=c?Object(je.jsx)(re,{label:"Item Title",value:i||"",onChange:function(e){return n(Object(k.a)(Object(k.a)({},t),{},{title:e.target.value}))}}):Object(je.jsx)(ue,{children:i}),u=c?Object(je.jsx)(re,{label:"Item Description",value:o||"",onChange:function(e){return n(Object(k.a)(Object(k.a)({},t),{},{description:e.target.value}))},variant:"outlined",multiline:!0,rows:3}):Object(je.jsx)(le,{children:o});return Object(je.jsxs)(ie,{style:{opacity:t?1:0},children:[Object(je.jsx)(oe,{title:s,action:Object(je.jsx)(P.a,{onClick:a,children:Object(je.jsx)(D.a,{})})}),Object(je.jsx)(se,{children:u})]})},be=n(79),pe=n(78),fe=function(e){var t,n=e.isEditor,c=e.pageControls,r=e.selectedPin,i=e.setSelectedPin,o=e.contentRef,s=c.imageId,l=c.pins,j=c.setPins,b=Object(a.useState)(),p=Object(u.a)(b,2),f=p[0],O=p[1],v=Object(a.useState)(!0),x=Object(u.a)(v,2),y=x[0],C=x[1],P=Object(a.useRef)({}),E=Object(a.useRef)(),D=Object(a.useRef)(!1),I=s&&(t=s,"".concat(h,"image/").concat(t));Object(a.useEffect)((function(){C(!0)}),[I]),Object(a.useEffect)((function(){y||S()}),[y]);var S=function(){if(E.current){var e=E.current,t=e.offsetLeft,n=e.offsetTop,a=e.width,c=e.height;O({offsetLeft:t,offsetTop:n,width:a,height:c})}};Object(a.useEffect)((function(){if(o.current){var e=new ResizeObserver((function(){S()})).observe(o.current);return function(){null===e||void 0===e||e.disconnect()}}}),[o.current,E.current]);var M=function(e){var t=function(e,t){var n=m(t),a=n.left,c=n.top;return{x:e.pageX-a,y:e.pageY-c}}(e,E.current),n=t.x,a=t.y;return{x:n/E.current.width,y:a/E.current.height}};return Object(je.jsxs)(je.Fragment,{children:[!y&&f&&Object.keys(l).map((function(e){var t=l[e];if(t){var a=t.x,c=t.y,o=r===e,s=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];j(Object(k.a)(Object(k.a)({},l),{},Object(w.a)({},e,Object(k.a)(Object(k.a)({},l[e]),t))),n)},u={},d=f.offsetLeft,b=f.offsetTop,p=f.width,O=f.height,g=d+a*p,h=b+c*O;return Object(je.jsx)(ae,{style:{left:"".concat(g,"px"),top:"".concat(h,"px"),color:o?"rgb(61, 161, 143)":"rgb(37, 247, 209)",transform:"translateX(-50%) translateY(-50%)".concat(o?"scale(1.3)":"scale(1)")},onClick:function(){return function(e){!D.current&&i(e===r?null:e)}(e)},onContextMenu:function(t){return function(e,t){if(n){t.preventDefault(),l[e];var a=Object(be.a)(l,[e].map(pe.a));j(a),i()}}(e,t)},ref:function(t){(null===P||void 0===P?void 0:P.current)&&(P.current[e]=t)},onMouseDown:function(e){var t=e.clientX,n=e.clientY;document.onmousemove=function(e){D.current=!0;var r=e.clientX-t,i=e.clientY-n,o=function(e){var t=m(E.current),n=t.left,a=t.top;return{x:e.x*E.current.width+n,y:e.y*E.current.height+a}}({x:a,y:c}),l=o.x,j=o.y,d=M({pageX:l+r,pageY:j+i}),b=d.x,p=d.y;s(u={x:b,y:p},!1)},document.onmouseup=function(e){s(u,!0),document.onmousemove=null,document.onmouseup=null,setTimeout((function(){D.current=!1}),0)}}},e)}})),y&&Object(je.jsx)(d.a,{}),Object(je.jsx)(ce,{src:I,onClick:function(e){if(n){var t=M(e);!function(e,t){var n=Object(g.a)();j(Object(k.a)(Object(k.a)({},l),{},Object(w.a)({},n,{x:e,y:t})))}(t.x,t.y)}},alt:"Map Page",ref:E,onLoad:function(){return C(!1)},style:y?{display:"none"}:{}})]})},Oe=function(e){var t=e.pageControls,n=e.isEditor,c=t.imageId,r=t.pins,i=t.setPins,o=Object(a.useState)(),s=Object(u.a)(o,2),l=s[0],j=s[1],d=Object(a.useRef)(),b=r[l];return Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(te,{ref:d,children:c?Object(je.jsx)(fe,{isEditor:n,pageControls:t,selectedPin:l,setSelectedPin:j,contentRef:d}):Object(je.jsxs)("div",{children:["Here's how to get started creating your map:",Object(je.jsx)("br",{}),Object(je.jsx)("br",{}),"1. Choose an image using the upload button above",Object(je.jsx)("br",{}),"2. Click on the image to add tags",Object(je.jsx)("br",{}),"3. Click on the tags to edit them"]})}),Object(je.jsx)(ne,{children:Object(je.jsx)(de,{pin:b,onClose:function(){return j()},setPin:function(e){i(Object(k.a)(Object(k.a)({},r),{},Object(w.a)({},l,e)))},isEditor:n})})]})};Oe.defaultProps={isEditor:!0};var ge=Oe,me=n(54),he="$set",ve="$unset",xe="$push",ye="$pull",Ce=function(e,t,n,a){var c=n.split("."),r=t;c.forEach((function(t,n){if(n===c.length-1)switch(e){case he:r[t]=a;break;case ve:delete r[t];break;case xe:case ye:r[t]||(r[t]=[]),r[t].push(a)}else r[t]||(r[t]={}),r=r[t]}))},we=function(e){var t=Object(a.useState)(),n=Object(u.a)(t,2),c=n[0],r=n[1],i=Object(a.useState)(!1),o=Object(u.a)(i,2),s=o[0],l=o[1],j=Object(a.useState)(!0),d=Object(u.a)(j,2),b=d[0],p=d[1];Object(a.useEffect)((function(){C.get(e).then((function(e){var t=e.data;l(!1),r(t)})).catch((function(e){console.error(e),l(!0)})).then((function(){p(!1)}))}),[e]);var f=Object(a.useCallback)((function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he,a=Object(w.a)({},n,t);return C.put(e,a)}),[e]);return{data:c,updateData:f,getProperty:function(e,t){var n,a=null!==(n=function(e,t){var n=t.split("."),a=e;return n.forEach((function(e){var t;a=null===(t=a)||void 0===t?void 0:t[e]})),a}(c,t))&&void 0!==n?n:e,i=function(e,n){var c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=a;r((function(a){var c=Object(me.cloneDeep)(a);return Ce(e,c,t,n),c})),c&&f(Object(w.a)({},t,n),e).catch((function(n){console.error(n),r((function(n){var a=Object(me.cloneDeep)(n);return Ce(e,a,t,i),a}))}))};return[a,function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i(he,e,t)},i]},error:s,loading:b}},ke=function(e){var t=we("maps/".concat(e)),n=t.data,a=t.updateData,c=t.getProperty,r=t.error,i=t.loading,o=c("Untitled Map","name"),s=Object(u.a)(o,2),l=s[0],j=s[1],d=c([],"pages.order"),b=Object(u.a)(d,3),p=b[0],f=b[1],O=b[2],g=c({},"pages.data"),m=Object(u.a)(g,2);return{mapData:n,updateMap:a,mapName:l,setMapName:j,pageOrder:p,pageData:m[0],setPageData:m[1],setPageOrder:f,updatePageOrder:O,getPageControls:function(e){var t="pages.data.".concat(e),n=c({},t),a=Object(u.a)(n,2),r=a[0],i=a[1],o=c("","".concat(t,".imageId")),s=Object(u.a)(o,2),l=s[0],j=s[1],d=c("","".concat(t,".name")),b=Object(u.a)(d,2),p=b[0],f=b[1],O=c({},"".concat(t,".pins")),g=Object(u.a)(O,2);return{pageData:r,setPageData:i,imageId:l,setImageId:j,pageName:p,setPageName:f,pins:g[0],setPins:g[1]}},error:r,loading:i}},Pe=function(e){var t=e.isEditor,n=Object(s.h)().mapId,c=Object(s.g)(),r=ke(n),i=r.mapData,o=r.mapName,b=r.setMapName,p=r.pageOrder,f=r.updatePageOrder,O=r.getPageControls,m=r.error,h=r.loading,v=t&&!h&&x!==(null===i||void 0===i?void 0:i.owner),y=m||v,w=Object(a.useState)(),k=Object(u.a)(w,2),P=k[0],E=k[1],D=!h&&!y;Object(a.useEffect)((function(){D&&!P&&E(p[0])}),[D,P,p]);var I=p.map((function(e,t){O(e).pageName;return Object(je.jsx)(B,{value:e,children:"Page ".concat(t+1)},e)}));t&&I.push(Object(je.jsx)(B,{value:"add",onClick:function(e){e.preventDefault(),function(){var e=Object(g.a)(),t={name:"Untitled Page",image:{id:"0c1de8f8-c585-4d4a-b5b2-75c8632027b6.jpg"},pins:{}};(0,O(e).setPageData)(t),f(xe,e),E(e)}()},children:"+"},"add"));var S=Object(je.jsxs)(je.Fragment,{children:[t&&Object(je.jsx)(l.a,{position:"static",children:Object(je.jsxs)(W,{children:[Object(je.jsx)(je.Fragment,{children:Object(je.jsx)(A,{variant:"contained",color:"secondary",onClick:function(){c.push("/")},children:"Back to Home"})}),D&&Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(q,{label:"Map Name",value:o,onChange:function(e){return b(e.target.value)},variant:"outlined"}),Object(je.jsxs)("div",{children:[Object(je.jsx)(V,{type:"file",id:"file",accept:"image/*",onChange:function(e){var t=O(P).setImageId;(function(e){var t=null===e||void 0===e?void 0:e[0],n=new FormData;return n.append("file",t),C.post("image",n,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){return e.data}))})(e.target.files).then((function(e){t(e)})).catch((function(e){console.error(e)}))}}),Object(je.jsx)("label",{htmlFor:"file",children:Object(je.jsxs)(j.a,{variant:"contained",color:"primary",component:"span",children:[Object(je.jsx)(_,{}),"Upload"]})}),Object(je.jsx)(A,{variant:"contained",color:"primary",onClick:function(){c.push("/maps/".concat(n,"/view"))},children:"View Map"})]})]})]})}),Object(je.jsx)(G,{children:Object(je.jsx)(K,{value:P,exclusive:!0,onChange:function(e,t){E(t)},children:I})}),!t&&Object(je.jsx)(Q,{children:"Tap on an item to learn more about it."})]});return Object(je.jsxs)(L,{children:[S,h?Object(je.jsx)(d.a,{}):y?Object(je.jsx)("p",{children:"Could not load the requested map!"}):function(){var e=O(P);return Object(je.jsxs)(je.Fragment,{children:[p.length>1&&Object(je.jsxs)(je.Fragment,{children:[Object(je.jsx)(Z,{onClick:function(){var e=p.indexOf(P);E(0===e?p[p.length-1]:p[e-1])}}),Object(je.jsx)(ee,{onClick:function(){var e=p.indexOf(P);e===p.length-1?E(p[0]):E(p[e+1])}})]}),Object(je.jsx)(ge,{pageControls:e,isEditor:t})]})}()]})};Pe.defaultProps={isEditor:!0};var Ee=Pe,De=function(){var e=Object(s.g)(),t=we("maps"),n=t.loading,a=t.error,c=t.data,r=function(t){e.push("/maps/".concat(t))},i=(void 0===c?[]:c).map((function(e){var t=e.name,n=e._id;return Object(je.jsx)($,{variant:"contained",onClick:function(){return r(n)},children:t},n)}));return Object(je.jsxs)(J,{children:[Object(je.jsx)($,{variant:"contained",color:"primary",onClick:function(){C.post("maps",function(){var e=Object(g.a)();return{name:"Untitled Map",pages:{order:[e],data:Object(w.a)({},e,{name:"Untitled Page",image:{id:"0c1de8f8-c585-4d4a-b5b2-75c8632027b6.jpg"},pins:{}})}}}()).then((function(e){var t=e.data;r(t)})).catch((function(e){console.error(e)}))},children:"Create New Map"}),n?Object(je.jsx)(d.a,{}):a?Object(je.jsx)("p",{children:"Could not load maps!"}):0===i.length?Object(je.jsx)("div",{children:'To get started, just click "Create New Map"!'}):i]})},Ie=function(){return Object(je.jsx)(o.a,{basename:"/",children:Object(je.jsxs)(s.d,{children:[Object(je.jsx)(s.b,{exact:!0,path:"/",children:Object(je.jsx)(De,{})}),Object(je.jsx)(s.b,{path:"/maps/:mapId/view",children:Object(je.jsx)(Ee,{isEditor:!1})}),Object(je.jsx)(s.b,{path:"/maps/:mapId",children:Object(je.jsx)(Ee,{isEditor:!0})}),Object(je.jsx)(s.a,{to:"/"})]})})};i.a.render(Object(je.jsx)(c.a.StrictMode,{children:Object(je.jsx)(Ie,{})}),document.getElementById("root"))},91:function(e,t,n){}},[[125,1,2]]]);
//# sourceMappingURL=main.9f827dd0.chunk.js.map